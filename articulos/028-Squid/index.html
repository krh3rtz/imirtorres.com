<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Pelican Static Site Generator, Powered by Python" />
    <meta name="description" content="En esta ocasión estaremos revisando la instalación de Squid proxy, una herramienta para el bloqueo de sitios web en la red local dentro de un sistema basado en RHEL.">
    <meta name="keywords" content="Linux, articulos">
    <meta name="author" content="Imir Torres">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="">
    <meta name="twitter:title" content="Squid proxy en Alma Linux">
    <meta name="twitter:description" content="En esta ocasión estaremos revisando la instalación de Squid proxy, una herramienta para el bloqueo de sitios web en la red local dentro de un sistema basado en RHEL.">
    <meta name="twitter:image" content="/articulos/028-Squid/preview1.png">
    <meta property="og:title" content="Squid proxy en Alma Linux">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/articulos/028-Squid/">
    <meta property="og:image" content="/articulos/028-Squid/preview1.png">
    <meta property="og:description" content="En esta ocasión estaremos revisando la instalación de Squid proxy, una herramienta para el bloqueo de sitios web en la red local dentro de un sistema basado en RHEL.">
    <meta property="og:site_name" content="Ethergroup | Blog">
    <title>Squid proxy en Alma Linux - Ethergroup | Blog</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" href="/theme/images/icon-hires.png" sizes="192x192" />
    <link rel="icon" href="/theme/images/icon-normal.png" sizes="128x128" />
    <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon.png" />
    <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon-76x76.png" sizes="76x76" />
    <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon-120x120.png" sizes="120x120" />
    <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon-152x152.png" sizes="152x152" />
    <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon-180x180.png" sizes="180x180" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" integrity="sha512-GQGU0fMMi238uA+a/bdWJfpUGKUkBdgfFdgBm72SUQ6BeyWjoY/ton0tEjH+OSH9iP4Dfh+7HM0I9f5eR0L/4w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans&display=swap" />
    <link rel="stylesheet" href="/theme/css/movimientolibre-bs5.css" />
</head>
<body>
<nav id="navigationBase" class="navbar navbar-expand-sm fixed-top">
    <div class="container">
        <a class="navbar-brand" href="/"><i class="fa fa-home"></i></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navigationCollapse" aria-controls="navigationCollapse" aria-expanded="false" aria-label="Toggle navigation">
            <span class="fas fa-bars"></span>
        </button>
        <div class="collapse navbar-collapse" id="navigationCollapse">
            <ul class="navbar-nav me-auto mb-2 mb-sm-0">
                <li class="nav-item"><a class="nav-link" href="/authors.html">Autores</a></li>
                <li class="nav-item"><a class="nav-link" href="/tags.html">Etiquetas</a></li>
                <li class="nav-item"><a class="nav-link" href="https://ethergroup.mx/">EtherGroup</a></li>
            </ul>
            <ul class="navbar-nav">
                <li><a class="mx-2" href="https://www.instagram.com/ethergroup/" target="_blank"><i class="fab fa-instagram-square fa-2x"></i></a></li>
                <li><a class="mx-2" href="https://www.facebook.com/EtherGroup-184831138858274" target="_blank"><i class="fab fa-facebook-square fa-2x"></i></a></li>
                <li><a class="mx-2" href="https://www.linkedin.com/company/ethergroup" target="_blank"><i class="fab fa-linkedin fa-2x"></i></a></li>
            </ul>
    </div>
    </div>
</nav><header id="headerSite" class="mb-4">
    <div id="headerSiteImage" class="container" itemscope itemtype="http://schema.org/Organization">
        <div class="row">
            <div class="col-xl-8">
                <h1 class="display-2" itemprop="name">Ethergroup | Blog</h1>
                <p class="lead" itemprop="description">Blog sobre tecnologías, hacking, ciberseguridad, software libre y mucho más</p>
            </div>
        </div>
    </div>
</header>    <div class="container">
        <div class="row">
            <div class="col-lg-8">
    <article>
        <script type="application/ld+json">
            {
                "@context": "http://schema.org",
                "@type": "Article",
                "publisher": {
                    "@type": "Organization",
                    "name": "Ethergroup | Blog",
                    "logo": {
                        "@type": "ImageObject",
                        "url": "/theme/images/ethergroup.png"
                    },
                    "url": ""
                },
                "author": "Imir Torres",
                "name": "Squid proxy en Alma Linux",
                "headline": "Squid proxy en Alma Linux",
                "description": "En esta ocasión estaremos revisando la instalación de Squid proxy, una herramienta para el bloqueo de sitios web en la red local dentro de un sistema basado en RHEL.",
                "dateCreated": "2022-09-02 10:00:00-05:00",
                "datePublished": "2022-09-02 10:00:00-05:00",
                "dateModified": "",
                "image": "/articulos/028-Squid/preview1.png",
                "url": "/articulos/028-Squid/"
            }
        </script>
        <h2>Squid proxy en Alma Linux</h2>
        <p class="lead">En esta ocasión estaremos revisando la instalación de Squid proxy, una herramienta para el bloqueo de sitios web en la red local dentro de un sistema basado en RHEL.</p>
        <p>02 September 2022</p>
        <p><img class="img-fluid" src="028.png" alt="Foto 0"></p>
<hr>
<p>En esta ocasión estaremos revisando la instalación de Squid proxy, una herramienta para el bloqueo de sitios web en la red local dentro de un sistema basado en RHEL, en este caso AlmaLinux, aunque el funcionamiento es válido para cualquier distribución.</p>
<p>Las capacidades que tiene este proxy son muchísimas. Se enfoca en la navegación de los usuarios impidiendo que puedan acceder a sitios que pueden tener contenido malicioso para las organizaciones. Por medio de caché, permite bloquear de forma más eficiente sitios que pueden ser visitados frecuentemente.</p>
<p>El proyecto funciona conforme a la GNU GPL.</p>
<p>Pueden encontrar más información sobre el proxy squid en: <a href="http://www.squid-cache.org/">http://www.squid-cache.org/</a></p>
<p>Primero vamos con la instalación del servicio:</p>
<div class="highlight"><pre><span></span><code>yum install squid
</code></pre></div>

<p>¡Regla de oro! Creamos una copia de seguridad de la configuración de fábrica, por cualquier cosa:</p>
<div class="highlight"><pre><span></span><code>cp /etc/squid/squid.conf /etc/squid/squid.conf.ori
</code></pre></div>

<p>Crearemos una carpeta para nuestras ACLS (Access Control Lists), así como los archivos para bloqueo, patrones de sitios:</p>
<div class="highlight"><pre><span></span><code>mkdir /etc/squid/acls
touch /etc/squid/acls/blocked_sites
touch /etc/squid/acls/site_patterns
</code></pre></div>

<p>En el archivo "blocked_sites" agregaremos una lista de sitios a bloquear. Puede ser por medio de wildcards como en este caso:</p>
<p>.yahoo.com
.xvideos.com</p>
<p>En el "sites_patters" agregaremos sitios cuyo dominio completo será restringido. La ventaja es que Squid agregará todo lo que contenga esta palabra y lo bloqueará:</p>
<p>softonic
taringa</p>
<p>Ahora que tenemos el archivo, pasamos a configurar el squid.conf:</p>
<div class="highlight"><pre><span></span><code>vim /etc/squid/squid.conf
</code></pre></div>

<p>Dentro de la configuración agregaremos la ACL que creamos. Comentamos las primeras líneas que hacen referencia a posibles redes locales. Es importante escribir correctamente los nombres de los archivos. </p>
<p>Luego agregamos lo siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="n">acl</span><span class="w"> </span><span class="n">CONNECT</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="n">CONNECT</span><span class="w"></span>
<span class="n">acl</span><span class="w"> </span><span class="n">blocked_sites</span><span class="w"> </span><span class="n">dstdomain</span><span class="w"> </span><span class="s">&quot;/etc/squid/acls/blocked_sites&quot;</span><span class="w"></span>
<span class="n">acl</span><span class="w"> </span><span class="n">site_patterns</span><span class="w"> </span><span class="n">url_regex</span><span class="w"> </span><span class="s">&quot;/etc/squid/acls/site_patterns&quot;</span><span class="w"></span>
</code></pre></div>

<p>En el lugar de las peticiones, lo que haremos es lo siguiente:</p>
<div class="highlight"><pre><span></span><code>#http_access allow localnet
#http_access allow localhost
http_access allow   site_patterns
http_access deny    blocked_sites
http_access allow   all
</code></pre></div>

<p>Casi al final del archivo de configuración, modificaremos el parámetro de puerto de escucha:</p>
<p>http_port 172.16.1.1:3128   -&gt; especificamos la IP del Centos</p>
<p>Recordemos que necesitamos aplicar las reglas del firewall para que nuestro proxy sea permitido en el firewall. En este caso utilizamos IPTables:</p>
<div class="highlight"><pre><span></span><code># <span class="nv">Enable</span> <span class="nv">NAT</span> <span class="nv">from</span> <span class="nv">LAN</span> <span class="nv">and</span> <span class="k">while</span> <span class="nv">redirecting</span> <span class="nv">trafic</span> <span class="nv">to</span> <span class="nv">our</span> <span class="nv">squid</span> <span class="nv">proxy</span> <span class="ss">(</span><span class="nv">nat</span> <span class="nv">table</span><span class="ss">)</span>
<span class="o">-</span><span class="nv">A</span> <span class="nv">PREROUTING</span> <span class="o">-</span><span class="nv">s</span> <span class="mi">172</span>.<span class="mi">16</span>.<span class="mi">1</span>.<span class="mi">0</span><span class="o">/</span><span class="mi">24</span> <span class="o">-</span><span class="nv">p</span> <span class="nv">tcp</span> <span class="o">--</span><span class="nv">dport</span> <span class="mi">80</span> <span class="o">-</span><span class="nv">j</span> <span class="nv">REDIRECT</span>  <span class="o">--</span><span class="nv">to</span><span class="o">-</span><span class="nv">port</span> <span class="mi">3128</span>
<span class="o">-</span><span class="nv">A</span> <span class="nv">PREROUTING</span> <span class="o">-</span><span class="nv">s</span> <span class="mi">172</span>.<span class="mi">16</span>.<span class="mi">1</span>.<span class="mi">0</span><span class="o">/</span><span class="mi">24</span>  <span class="o">-</span><span class="nv">p</span> <span class="nv">tcp</span> <span class="o">--</span><span class="nv">dport</span> <span class="mi">443</span> <span class="o">-</span><span class="nv">j</span> <span class="nv">REDIRECT</span> <span class="o">--</span><span class="nv">to</span><span class="o">-</span><span class="nv">port</span> <span class="mi">3128</span>
<span class="o">-</span><span class="nv">A</span> <span class="nv">POSTROUTING</span> <span class="o">-</span><span class="nv">s</span> <span class="mi">172</span>.<span class="mi">16</span>.<span class="mi">1</span>.<span class="mi">0</span><span class="o">/</span><span class="mi">24</span>  <span class="o">-</span><span class="nv">o</span> <span class="nv">enp0s3</span> <span class="o">-</span><span class="nv">j</span> <span class="nv">MASQUERADE</span>

# <span class="nv">Allow</span> <span class="nv">squid</span> <span class="nv">proxy</span> <span class="nv">connections</span> <span class="ss">(</span><span class="nv">filter</span> <span class="nv">table</span><span class="ss">)</span>
<span class="o">-</span><span class="nv">A</span> <span class="nv">INPUT</span> <span class="o">-</span><span class="nv">p</span> <span class="nv">tcp</span> <span class="o">-</span><span class="nv">i</span> <span class="nv">enp0s3</span> <span class="o">-</span><span class="nv">d</span> <span class="mi">172</span>.<span class="mi">16</span>.<span class="mi">1</span>.<span class="mi">1</span> <span class="o">--</span><span class="nv">dport</span> <span class="mi">3128</span> <span class="o">-</span><span class="nv">j</span> <span class="nv">ACCEP</span>
</code></pre></div>

<p>Ahora podemos habilitar el proxy para cuando el servidor inicie:</p>
<div class="highlight"><pre><span></span><code>systemctl enable squid
systemctl start squid
</code></pre></div>

<p>Es momento de configurar las opciones de proxy dentro de nuestros equipos cliente:</p>
<p>server: 172.16.1.1
port:   3128</p>
<p>También existe la posibilidad de crear un proxy transparente, pero eso ya le queda de tarea.</p>
<p>Video Referencia en el curso de servidores (Debian Server): <a href="https://www.youtube.com/watch?v=mbrxEKCvtsU&amp;list=PLHZHedbtfQEOsUzXIlliX9rLG_3NsxjBH&amp;index=8&amp;ab_channel=EtherGroup">https://www.youtube.com/watch?v=mbrxEKCvtsU&amp;list=PLHZHedbtfQEOsUzXIlliX9rLG_3NsxjBH&amp;index=8&amp;ab_channel=EtherGroup</a></p>
<p>¡Happy Hacking!</p>
    </article>
            </div>
            <div class="col-lg-4">
                <aside>
<div id="asideAbout" class="card border-0">
    <div class="card-body">
        <h3 class="card-title mt-0">A cerca de EtherGroup</h3>
        <p class="card-text">
            Ethergroup es una empresa mexicana dedicada 
            a proveer servicios integrales en tecnologías
            de Información. Lideramos la transformación 
            tecnológica de nuestros clientes paso a paso, 
            de forma segura y fungimos como impulso a su 
            negocio en esta era digital.
            <br> <br>
            En Ethergroup nos encanta compartir 
            contenido te dejamos este espacio, 
            que busca divulgar conocimiento de 
            diferentes áreas.
        </p>
    </div>
</div><div id="asideTags" class="card border-0">
    <div class="card-body">
        <h3 class="card-title mt-0">Etiquetas</h3>
        <ul class="list-group list-group-flush">
<li class="list-group-item"><a href="/tag/ciberataque.html">Ciberataque</a></li><li class="list-group-item"><a href="/tag/ciberataques.html">Ciberataques</a></li><li class="list-group-item"><a href="/tag/ciberseguridad.html">Ciberseguridad</a></li><li class="list-group-item"><a href="/tag/hacking.html">Hacking</a></li><li class="list-group-item"><a href="/tag/linux.html">Linux</a></li><li class="list-group-item"><a href="/tag/malware.html">Malware</a></li><li class="list-group-item"><a href="/tag/programacion.html">Programación</a></li><li class="list-group-item"><a href="/tag/ransomware.html">Ransomware</a></li><li class="list-group-item"><a href="/tag/servidores.html">Servidores</a></li><li class="list-group-item"><a href="/tag/vulnerabilidad.html">Vulnerabilidad</a></li>        </ul>
    </div>
</div>                </aside>
            </div>
        </div>
    </div>
<footer class="text-muted">
    <div class="container">
        <p>
            Copyright &copy; Ethergroup 2021 | Cybersecurity E-group S. de R.L. de C.V. Sitio web de la empresa Ethergroup.
            Sitio web de la empresa <a href="https://ethergroup.mx/">EtherGroup.</a> 
        </p>
    </div>
</footer>    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/js/bootstrap.min.js" integrity="sha512-OvBgP9A2JBgiRad/mM36mkzXSXaJE9BEIENnVEmeZdITvwT09xnxLtT4twkCa8m/loMbPHsvPl0T8lRGVBwjlQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="/theme/js/navigation.js"></script>
</body>
</html>